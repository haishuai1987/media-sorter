# 使用指南

## 目录
- [首次使用](#首次使用)
- [功能说明](#功能说明)
- [命名规则](#命名规则)
- [冲突处理](#冲突处理)
- [使用技巧](#使用技巧)

---

## 首次使用

### 1. 配置API密钥

点击 **⚙️ 设置** 按钮：

#### TMDB配置
- **API Key**: 你的TMDB API密钥
  - 获取地址: https://www.themoviedb.org/settings/api
  - 注册账号 → Settings → API → 申请API Key
- **代理地址**: http://proxy:port（可选）
- **代理类型**: HTTP/HTTPS 或 SOCKS5

#### 豆瓣配置
- **Cookie**: 你的豆瓣Cookie
  - 登录 https://movie.douban.com/
  - 按F12打开开发者工具
  - Network标签 → 刷新页面
  - 复制Cookie

### 2. 配置路径

```
待整理目录: /path/to/待整理
电影输出目录: /path/to/电影
剧集输出目录: /path/to/剧集
```

**NAS系统路径示例**：
- Synology: `/volume1/media/待整理`
- QNAP: `/share/media/待整理`
- TrueNAS: `/mnt/pool/media/待整理`
- Unraid: `/mnt/user/media/待整理`

### 3. 选择冲突策略

- **自动比较**: 智能比较文件质量（推荐）
- **跳过**: 保留旧文件，跳过新文件
- **替换**: 用新文件替换旧文件
- **保留两个**: 新文件添加版本号.v1

### 4. 开始整理

点击 **🚀 一键整理入库** 按钮

### 5. 查看进度

点击 **📊 整理详情** 查看实时进度

---

## 功能说明

### 智能重命名

自动识别并提取：
- 电影/剧集名称
- 年份
- 季集信息（剧集）
- 分辨率（4K, 1080p, 720p等）
- 来源（BluRay, WEB-DL, HDTV等）
- 编码（H.265, H.264等）

### 中文标题识别

**查询优先级**：豆瓣 > TMDB

**豆瓣查询**：
- 提供中文标题
- 提供中文简介
- 不需要代理

**TMDB查询**：
- 提供英文标题
- 自动翻译为中文
- 可能需要代理

### 智能去重

**质量评分系统**：
- 分辨率：4K=2160, 1080p=1080, 720p=720
- 来源：REMUX=100, BluRay=80, WEB-DL=60
- 格式：MKV=5, MP4=3, AVI=1
- 编码：H.265=2, H.264=1

**去重规则**：
- 识别相同电影/剧集的不同版本
- 计算质量总分
- 保留最高分版本
- 删除低分版本

### 智能分类

**电影分类**：
- **动画电影**: 类型包含动画
- **华语电影**: 原始语言为中文
- **外语电影**: 其他语言

**剧集分类**：
- **国漫**: 动画 + 中国/台湾/香港
- **日番**: 动画 + 日本
- **纪录片**: 类型为纪录片
- **国产剧**: 中国/台湾/香港剧集
- **日韩剧**: 日本/韩国剧集
- **欧美剧**: 欧美国家剧集

### 冲突处理

**自动比较策略**：
1. 比较文件质量分数
2. 新文件更好 → 替换旧文件
3. 旧文件更好 → 保留旧文件
4. 质量相同 → 保留旧文件

**其他策略**：
- **跳过**: 直接保留旧文件
- **替换**: 直接用新文件替换
- **保留两个**: 新文件添加.v1后缀

### 自动清理

**清理内容**：
- 跳过的文件（质量相同或较差）
- 空文件夹（递归删除）
- 临时文件

**清理时机**：
- 所有文件处理完成后
- 自动执行

---

## 命名规则

### 电影命名

**格式**：
```
电影名称 (年份) [分辨率-来源].扩展名
```

**示例**：
```
流浪地球 (2019) [1080p-BluRay].mkv
肖申克的救赎 (1994) [4K-REMUX].mkv
千与千寻 (2001) [720p-WEB-DL].mp4
```

### 剧集命名

**格式**：
```
剧集名称 (年份)/Season XX/剧集名称 - SXXEXX [分辨率-来源].扩展名
```

**示例**：
```
三体 (2023)/Season 01/三体 - S01E01 [1080p-WEB-DL].mkv
权力的游戏 (2011)/Season 01/权力的游戏 - S01E01 [4K-BluRay].mkv
```

### 字幕命名

**格式**：
```
与视频文件同名.语言标识.srt
```

**示例**：
```
流浪地球 (2019) [1080p-BluRay].chs.srt
流浪地球 (2019) [1080p-BluRay].eng.srt
```

---

## 冲突处理

### 场景1: 新文件质量更好

```
旧文件: 流浪地球 (2019) [720p-WEB-DL].mkv
新文件: 流浪地球 (2019) [1080p-BluRay].mkv

结果: 删除旧文件，保留新文件
```

### 场景2: 旧文件质量更好

```
旧文件: 流浪地球 (2019) [1080p-BluRay].mkv
新文件: 流浪地球 (2019) [720p-WEB-DL].mkv

结果: 保留旧文件，跳过新文件
```

### 场景3: 质量相同

```
旧文件: 流浪地球 (2019) [1080p-WEB-DL].mkv
新文件: 流浪地球 (2019) [1080p-WEB-DL].mkv

结果: 保留旧文件，跳过新文件
```

### 场景4: 保留两个版本

```
旧文件: 流浪地球 (2019) [1080p-BluRay].mkv
新文件: 流浪地球 (2019) [1080p-WEB-DL].mkv

结果: 
- 流浪地球 (2019) [1080p-BluRay].mkv
- 流浪地球 (2019) [1080p-WEB-DL].v1.mkv
```

---

## 使用技巧

### 首次使用

1. **小批量测试**: 先用5-10个文件测试
2. **检查结果**: 确认命名和分类正确
3. **调整策略**: 根据需要调整冲突策略
4. **批量处理**: 确认无误后批量处理

### 日常使用

1. **新文件放入待整理目录**
2. **点击"一键整理入库"**
3. **系统自动完成所有操作**
4. **查看"整理详情"了解进度**

### 增量更新

1. **使用"跳过"策略**
2. **只处理新增文件**
3. **不影响已整理的库**
4. **定期运行保持整洁**

### 批量处理

1. **建议每次50-100个文件**
2. **大文件（>10GB）单独处理**
3. **避免同时处理过多文件**
4. **可以多次运行**

### 网盘用户

1. **处理速度较慢属正常**
2. **系统已针对网盘优化**
3. **增加了重试机制**
4. **增加了操作延迟**

### 分享给朋友

1. **每个用户配置自己的API密钥**
2. **避免共享导致的限制**
3. **独立的访问记录**
4. **互不影响**

---

## 常见问题

### Q: 如何获取TMDB API Key？
A: 访问 https://www.themoviedb.org/settings/api，注册账号后申请。

### Q: 豆瓣Cookie多久过期？
A: 通常1-3个月，过期后重新获取即可。

### Q: 是否需要代理？
A: TMDB可能需要代理，豆瓣不需要。

### Q: 如何处理特殊字符？
A: 系统自动清理非法字符，确保跨平台兼容。

### Q: 支持哪些文件格式？
A: 
- 视频: mp4, mkv, avi, mov, ts, iso等
- 字幕: srt, ass, ssa

### Q: 如何撤销操作？
A: 建议操作前备份，或使用NAS的快照功能。

### Q: 处理速度慢怎么办？
A: 
- 减少单次处理文件数量
- 检查网络连接
- 增加重试延迟

更多问题请查看 [常见问题文档](常见问题.md)
