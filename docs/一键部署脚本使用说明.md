# ä¸€é”®éƒ¨ç½²è„šæœ¬ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`deploy-cloud.sh` æ˜¯äº‘æœåŠ¡å™¨ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆæ‰€æœ‰éƒ¨ç½²æ­¥éª¤ã€‚

---

## ä½¿ç”¨æ–¹æ³•

### 1. ä¸‹è½½è„šæœ¬

```bash
# æ–¹æ³• 1ï¼šå…‹éš†æ•´ä¸ªé¡¹ç›®
git clone https://github.com/haishuai1987/media-sorter.git
cd media-sorter

# æ–¹æ³• 2ï¼šåªä¸‹è½½è„šæœ¬
wget https://raw.githubusercontent.com/haishuai1987/media-sorter/main/deploy-cloud.sh
chmod +x deploy-cloud.sh
```

---

### 2. è¿è¡Œè„šæœ¬

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy-cloud.sh

# è¿è¡Œè„šæœ¬
./deploy-cloud.sh
```

---

### 3. æŒ‰æç¤ºè¾“å…¥ä¿¡æ¯

è„šæœ¬ä¼šè¯¢é—®ä»¥ä¸‹ä¿¡æ¯ï¼š

#### å¿…å¡«ä¿¡æ¯

**åŸŸå**ï¼š
```
è¯·è¾“å…¥åŸŸåï¼ˆå¦‚ media.example.comï¼‰: your-domain.com
```

**SSL è¯ä¹¦**ï¼š
```
æ˜¯å¦é…ç½® SSL è¯ä¹¦ï¼Ÿ(y/n): y
```

**é‚®ç®±**ï¼ˆå¦‚æœé…ç½® SSLï¼‰ï¼š
```
è¯·è¾“å…¥é‚®ç®±ï¼ˆç”¨äº Let's Encryptï¼‰: your@email.com
```

#### å¯é€‰ä¿¡æ¯

**å®‰è£…ç›®å½•**ï¼ˆé»˜è®¤ /opt/media-renamerï¼‰ï¼š
```
å®‰è£…ç›®å½•ï¼ˆé»˜è®¤ /opt/media-renamerï¼‰: [ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤]
```

---

### 4. ç¡®è®¤å¹¶å¼€å§‹éƒ¨ç½²

è„šæœ¬ä¼šæ˜¾ç¤ºé…ç½®ä¿¡æ¯ï¼š

```
é…ç½®ä¿¡æ¯ï¼š
  åŸŸå: your-domain.com
  SSL: true
  é‚®ç®±: your@email.com
  å®‰è£…ç›®å½•: /opt/media-renamer

ç¡®è®¤å¼€å§‹éƒ¨ç½²ï¼Ÿ(y/n): y
```

è¾“å…¥ `y` å¼€å§‹è‡ªåŠ¨éƒ¨ç½²ã€‚

---

## éƒ¨ç½²æ­¥éª¤

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. âœ… æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ
2. âœ… æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…
3. âœ… å®‰è£…ä¾èµ–ï¼ˆPython3ã€Gitã€Nginxã€Certbotï¼‰
4. âœ… å…‹éš†é¡¹ç›®åˆ°æŒ‡å®šç›®å½•
5. âœ… é…ç½®ç¯å¢ƒå˜é‡
6. âœ… é…ç½® Nginx åå‘ä»£ç†
7. âœ… é…ç½® SSL è¯ä¹¦ï¼ˆå¦‚æœé€‰æ‹©ï¼‰
8. âœ… åˆ›å»º Systemd æœåŠ¡
9. âœ… é…ç½®é˜²ç«å¢™
10. âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€

---

## éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºï¼š

```
========================================
  éƒ¨ç½²å®Œæˆï¼
========================================

è®¿é—®åœ°å€: https://your-domain.com

å¸¸ç”¨å‘½ä»¤:
  æŸ¥çœ‹æœåŠ¡çŠ¶æ€: sudo systemctl status media-renamer
  æŸ¥çœ‹æ—¥å¿—: sudo journalctl -u media-renamer -f
  é‡å¯æœåŠ¡: sudo systemctl restart media-renamer
  åœæ­¢æœåŠ¡: sudo systemctl stop media-renamer

é…ç½®æ–‡ä»¶ä½ç½®:
  åº”ç”¨ç›®å½•: /opt/media-renamer
  Nginx é…ç½®: /etc/nginx/sites-available/media-renamer
  Systemd æœåŠ¡: /etc/systemd/system/media-renamer.service

SSL è¯ä¹¦:
  è¯ä¹¦ä½ç½®: /etc/letsencrypt/live/your-domain.com/
  è‡ªåŠ¨ç»­æœŸ: å·²å¯ç”¨ï¼ˆcertbot.timerï¼‰

ä¸‹ä¸€æ­¥:
  1. è®¿é—®åº”ç”¨å¹¶å®Œæˆåˆå§‹é…ç½®
  2. åœ¨è®¾ç½®ä¸­é…ç½® TMDB API Key å’Œè±†ç“£ Cookie
  3. é…ç½®åª’ä½“åº“è·¯å¾„
```

---

## ç³»ç»Ÿè¦æ±‚

### æ¨èé…ç½®

- **ç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS æˆ– 20.04 LTS
- **CPU**ï¼š2æ ¸
- **å†…å­˜**ï¼š2GB
- **ç¡¬ç›˜**ï¼š40GB SSD
- **å¸¦å®½**ï¼š3Mbps

### æ”¯æŒçš„ç³»ç»Ÿ

- âœ… Ubuntu 22.04 LTSï¼ˆæ¨èï¼‰
- âœ… Ubuntu 20.04 LTS
- âš ï¸ Debian 11/12ï¼ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´ï¼‰
- âš ï¸ CentOS/Rocky Linuxï¼ˆå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´ï¼‰

---

## å‰ç½®è¦æ±‚

### 1. åŸŸåé…ç½®

åœ¨è¿è¡Œè„šæœ¬å‰ï¼Œéœ€è¦å…ˆé…ç½®åŸŸå DNSï¼š

```
ç±»å‹    ä¸»æœºè®°å½•    è®°å½•å€¼
A       @          your-server-ip
A       www        your-server-ip
```

ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆé€šå¸¸ 10 åˆ†é’Ÿåˆ° 24 å°æ—¶ï¼‰ã€‚

### 2. æœåŠ¡å™¨è®¿é—®

ç¡®ä¿ä½ å¯ä»¥é€šè¿‡ SSH è®¿é—®æœåŠ¡å™¨ï¼š

```bash
ssh user@your-server-ip
```

### 3. æƒé™

- éœ€è¦ sudo æƒé™
- å»ºè®®ä½¿ç”¨æ™®é€šç”¨æˆ· + sudoï¼ˆä¸æ¨èç›´æ¥ä½¿ç”¨ rootï¼‰

---

## å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status media-renamer

# å¯åŠ¨æœåŠ¡
sudo systemctl start media-renamer

# åœæ­¢æœåŠ¡
sudo systemctl stop media-renamer

# é‡å¯æœåŠ¡
sudo systemctl restart media-renamer

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u media-renamer -f

# æŸ¥çœ‹æœ€è¿‘ 50 æ¡æ—¥å¿—
sudo journalctl -u media-renamer -n 50
```

---

### Nginx ç®¡ç†

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

---

### SSL è¯ä¹¦ç®¡ç†

```bash
# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

---

## æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u media-renamer -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8000

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
cd /opt/media-renamer
python3 app.py
```

---

### 2. Nginx 502 é”™è¯¯

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status media-renamer

# æ£€æŸ¥ç«¯å£
curl http://127.0.0.1:8000

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

---

### 3. SSL è¯ä¹¦é…ç½®å¤±è´¥

**åŸå› **ï¼š
- DNS æœªç”Ÿæ•ˆ
- é˜²ç«å¢™é˜»æ­¢ 80/443 ç«¯å£
- åŸŸåè§£æé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ DNS è§£æ
nslookup your-domain.com

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ‰‹åŠ¨é…ç½® SSL
sudo certbot --nginx -d your-domain.com
```

---

### 4. æ— æ³•è®¿é—®åŸŸå

```bash
# æ£€æŸ¥ DNS è§£æ
nslookup your-domain.com

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status nginx
sudo systemctl status media-renamer
```

---

## å¸è½½

å¦‚æœéœ€è¦å¸è½½ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åœæ­¢å¹¶ç¦ç”¨æœåŠ¡
sudo systemctl stop media-renamer
sudo systemctl disable media-renamer

# åˆ é™¤æœåŠ¡æ–‡ä»¶
sudo rm /etc/systemd/system/media-renamer.service
sudo systemctl daemon-reload

# åˆ é™¤ Nginx é…ç½®
sudo rm /etc/nginx/sites-enabled/media-renamer
sudo rm /etc/nginx/sites-available/media-renamer
sudo systemctl restart nginx

# åˆ é™¤åº”ç”¨ç›®å½•
sudo rm -rf /opt/media-renamer

# åˆ é™¤ SSL è¯ä¹¦ï¼ˆå¯é€‰ï¼‰
sudo certbot delete --cert-name your-domain.com
```

---

## æ›´æ–°åº”ç”¨

```bash
# è¿›å…¥åº”ç”¨ç›®å½•
cd /opt/media-renamer

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡å¯æœåŠ¡
sudo systemctl restart media-renamer
```

---

## å®‰å…¨å»ºè®®

### 1. ä¿®æ”¹ SSH ç«¯å£

```bash
sudo nano /etc/ssh/sshd_config
# ä¿®æ”¹ Port 22 ä¸ºå…¶ä»–ç«¯å£
sudo systemctl restart sshd
```

### 2. ç¦ç”¨ root ç™»å½•

```bash
sudo nano /etc/ssh/sshd_config
# è®¾ç½® PermitRootLogin no
sudo systemctl restart sshd
```

### 3. é…ç½® fail2ban

```bash
sudo apt install fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

---

## å¸¸è§é—®é¢˜

### Q1: è„šæœ¬æ”¯æŒå“ªäº›ç³»ç»Ÿï¼Ÿ

**A**: ä¸»è¦æ”¯æŒ Ubuntu 22.04/20.04 LTSï¼Œå…¶ä»–ç³»ç»Ÿå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´ã€‚

---

### Q2: å¯ä»¥ä¸é…ç½® SSL å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œè„šæœ¬ä¼šè¯¢é—®æ˜¯å¦é…ç½® SSLã€‚ä½†å¼ºçƒˆå»ºè®®é…ç½® HTTPSã€‚

---

### Q3: å¯ä»¥ä¿®æ”¹å®‰è£…ç›®å½•å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œè„šæœ¬ä¼šè¯¢é—®å®‰è£…ç›®å½•ï¼Œé»˜è®¤ä¸º /opt/media-renamerã€‚

---

### Q4: éƒ¨ç½²å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç³»ç»Ÿè¦æ±‚
3. æŸ¥çœ‹æ•…éšœæ’æŸ¥éƒ¨åˆ†
4. æäº¤ Issue

---

### Q5: å¦‚ä½•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ

**A**: 
```bash
cd /opt/media-renamer
git pull origin main
sudo systemctl restart media-renamer
```

---

## è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹ [äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—](./äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md)
- â“ æŸ¥çœ‹ [å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md)
- ğŸ› æäº¤ Issue

---

## æ€»ç»“

ä¸€é”®éƒ¨ç½²è„šæœ¬å¯ä»¥ï¼š

âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - æ— éœ€æ‰‹åŠ¨é…ç½®
âœ… **äº¤äº’å¼é…ç½®** - å‹å¥½çš„ç”¨æˆ·ç•Œé¢
âœ… **å®Œæ•´åŠŸèƒ½** - åŒ…å« Nginxã€SSLã€Systemd
âœ… **é”™è¯¯å¤„ç†** - è‡ªåŠ¨æ£€æŸ¥å’Œæç¤º
âœ… **æ˜“äºä½¿ç”¨** - åªéœ€è¿è¡Œä¸€ä¸ªå‘½ä»¤

äº«å—è‡ªåŠ¨åŒ–çš„éƒ¨ç½²ä½“éªŒï¼ğŸš€
