# 设置功能说明

## 功能概述

新增"设置"按钮，允许用户配置自己的TMDB API Key、豆瓣Cookie和代理设置，避免多用户共享导致的API限制和风控问题。

---

## 界面布局

### 按钮组合
```
[🚀 一键整理入库]  [📊 整理详情]  [⚙️ 设置]
```

- **一键整理入库**：启动处理流程（紫色）
- **整理详情**：查看实时进度（绿色）
- **设置**：配置API和代理（橙色）

---

## 设置项说明

### 🎬 TMDB配置

#### 1. API Key
- **用途**：访问TMDB数据库获取电影/剧集信息
- **获取方法**：
  1. 访问 https://www.themoviedb.org/
  2. 注册/登录账号
  3. 进入 Settings → API
  4. 申请API Key（免费）
  5. 复制API Key到设置中

#### 2. 代理地址
- **格式**：
  - HTTP: `http://192.168.1.1:7890`
  - HTTPS: `https://192.168.1.1:7890`
  - SOCKS5: `socks5://192.168.1.1:1080`
- **用途**：访问TMDB（国内可能需要）
- **可选**：留空则不使用代理

#### 3. 代理类型
- **HTTP/HTTPS**：常见的HTTP代理
- **SOCKS5**：更底层的代理协议

### 🎭 豆瓣配置

#### 1. Cookie
- **用途**：访问豆瓣获取中文标题和评分
- **获取方法**：
  1. 浏览器登录 https://movie.douban.com/
  2. 按F12打开开发者工具
  3. 切换到Network标签
  4. 刷新页面
  5. 点击任意请求
  6. 在Headers中找到Cookie
  7. 复制完整Cookie到设置中

**注意**：豆瓣在国内可以直接访问，不需要代理

---

## 使用场景

### 场景1: 个人使用
```
用户操作：
1. 点击"设置"按钮
2. 输入自己的TMDB API Key
3. 输入自己的豆瓣Cookie
4. 配置代理（如需要）
5. 保存设置

优势：
- 使用自己的API配额
- 避免被风控
- 独立的访问记录
```

### 场景2: 分享给朋友
```
分享者：
1. 分享程序文件
2. 告知朋友需要自己配置

使用者：
1. 安装程序
2. 点击"设置"
3. 配置自己的API Key和Cookie
4. 开始使用

优势：
- 不会消耗分享者的API配额
- 每个人独立配置
- 避免共享导致的限制
```

### 场景3: 多设备使用
```
用户操作：
1. 在设备A配置设置
2. 在设备B重新配置
3. 每个设备独立配置

优势：
- 配置保存在本地
- 不同设备可以用不同配置
- 灵活性高
```

---

## 配置文件

### 存储位置
```
~/.media-renamer/config.json
```

- **Linux/Mac**: `/home/username/.media-renamer/config.json`
- **Windows**: `C:\Users\username\.media-renamer\config.json`

### 文件格式
```json
{
  "tmdb_api_key": "your-api-key",
  "tmdb_proxy": "http://192.168.1.1:7890",
  "tmdb_proxy_type": "http",
  "douban_cookie": "your-cookie"
}
```

### 手动编辑
也可以直接编辑配置文件：
```bash
# 编辑配置
nano ~/.media-renamer/config.json

# 重启服务生效
python3 app.py
```

---

## 代理配置详解

### HTTP/HTTPS代理

#### 常见代理软件
- **Clash**: http://127.0.0.1:7890
- **V2Ray**: http://127.0.0.1:10809
- **Shadowsocks**: http://127.0.0.1:1080
- **Surge**: http://127.0.0.1:6152

#### 配置示例
```
代理地址: http://127.0.0.1:7890
代理类型: HTTP/HTTPS
```

### SOCKS5代理

#### 常见代理软件
- **Shadowsocks**: socks5://127.0.0.1:1080
- **V2Ray**: socks5://127.0.0.1:10808
- **SSH隧道**: socks5://127.0.0.1:1080

#### 配置示例
```
代理地址: socks5://127.0.0.1:1080
代理类型: SOCKS5
```

### 局域网代理

如果代理在其他设备上：
```
代理地址: http://192.168.1.100:7890
代理类型: HTTP/HTTPS
```

---

## 安全建议

### 1. Cookie安全
- ⚠️ Cookie包含登录信息，不要分享给他人
- ⚠️ 定期更新Cookie（豆瓣会话过期）
- ⚠️ 不要在公共电脑上保存Cookie

### 2. API Key安全
- ⚠️ API Key是个人凭证，不要公开
- ⚠️ 如果泄露，及时在TMDB重新生成
- ⚠️ 注意API使用配额

### 3. 代理安全
- ⚠️ 只使用可信的代理服务
- ⚠️ 注意代理的隐私政策
- ⚠️ 避免使用免费公共代理

---

## 故障排查

### 问题1: TMDB无法访问
```
检查项：
1. API Key是否正确
2. 代理是否正常工作
3. 代理地址格式是否正确
4. 网络连接是否正常

解决方法：
- 测试代理: curl -x http://proxy:port https://api.themoviedb.org/3
- 检查API Key: 登录TMDB查看
- 更换代理服务器
```

### 问题2: 豆瓣无法访问
```
检查项：
1. Cookie是否过期
2. Cookie格式是否完整
3. 是否需要代理

解决方法：
- 重新获取Cookie
- 检查Cookie完整性
- 尝试添加代理
```

### 问题3: 设置无法保存
```
检查项：
1. 配置目录权限
2. 磁盘空间
3. 文件系统权限

解决方法：
- 检查权限: ls -la ~/.media-renamer/
- 手动创建目录: mkdir -p ~/.media-renamer
- 修改权限: chmod 755 ~/.media-renamer
```

### 问题4: 代理不生效
```
检查项：
1. 代理地址格式
2. 代理类型选择
3. 代理服务是否运行

解决方法：
- 检查格式: http://host:port 或 socks5://host:port
- 测试代理: curl -x proxy_url https://www.google.com
- 重启代理服务
```

---

## 高级配置

### 使用环境变量
```bash
# 设置环境变量
export TMDB_API_KEY="your-key"
export TMDB_PROXY="http://proxy:port"

# 启动程序
python3 app.py
```

### 使用配置文件
```bash
# 创建配置
cat > ~/.media-renamer/config.json << EOF
{
  "tmdb_api_key": "your-key",
  "tmdb_proxy": "http://proxy:port"
}
EOF

# 启动程序
python3 app.py
```

### Docker环境
```yaml
# docker-compose.yml
services:
  media-renamer:
    environment:
      - TMDB_API_KEY=your-key
      - TMDB_PROXY=http://proxy:port
    volumes:
      - ./config:/root/.media-renamer
```

---

## API配额说明

### TMDB API
- **免费配额**: 每天40,000次请求
- **速率限制**: 每10秒40次请求
- **建议**: 个人使用完全足够

### 豆瓣
- **无官方API**: 使用网页爬取
- **速率限制**: 建议间隔1-2秒
- **风控**: 频繁请求可能被限制

---

## 最佳实践

### 1. 定期更新
- 每月更新一次豆瓣Cookie
- 检查TMDB API Key状态
- 更新代理配置

### 2. 备份配置
```bash
# 备份配置
cp ~/.media-renamer/config.json ~/config.backup.json

# 恢复配置
cp ~/config.backup.json ~/.media-renamer/config.json
```

### 3. 多环境配置
```bash
# 开发环境
cp config.dev.json ~/.media-renamer/config.json

# 生产环境
cp config.prod.json ~/.media-renamer/config.json
```

---

## 总结

设置功能让每个用户可以：

✅ **独立配置** - 使用自己的API Key和Cookie
✅ **灵活代理** - 支持HTTP和SOCKS5代理
✅ **安全隔离** - 避免共享导致的风控
✅ **简单易用** - 图形界面配置
✅ **持久保存** - 配置自动保存到本地

现在你可以放心地分享程序给朋友，每个人使用自己的配置，互不影响！🎉
