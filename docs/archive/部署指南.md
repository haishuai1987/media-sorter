# 飞牛OS部署指南

## 📦 准备文件

需要上传到飞牛OS的文件：
- `app.py` - 后端服务器
- `index.html` - 前端页面

## 🚀 部署步骤

### 方法一：SSH部署（推荐）

#### 1. 连接到飞牛OS
```bash
ssh root@你的NAS_IP
# 例如：ssh root@192.168.1.100
# 默认密码通常是你设置的管理员密码
```

#### 2. 创建项目目录
```bash
mkdir -p /root/media-manager
cd /root/media-manager
```

#### 3. 上传文件
在你的电脑上，使用SCP上传文件：
```bash
# Windows PowerShell 或 CMD
scp app.py root@你的NAS_IP:/root/media-manager/
scp index.html root@你的NAS_IP:/root/media-manager/

# 或者使用WinSCP等图形化工具上传
```

#### 4. 检查Python版本
```bash
python3 --version
# 应该显示 Python 3.x.x
```

#### 5. 启动服务
```bash
cd /root/media-manager
python3 app.py
```

你应该看到：
```
==================================================
📁 媒体和字幕文件管理器 V1
==================================================
服务器运行在: http://localhost:8090
局域网访问: http://你的NAS_IP:8090
扫描路径: /vol02/1000-1-b23abde7/待整理
按 Ctrl+C 停止服务器
==================================================
```

#### 6. 访问Web界面
在浏览器中打开：
```
http://你的NAS_IP:8090
```

---

### 方法二：后台运行（推荐用于长期运行）

#### 1. 使用nohup后台运行
```bash
cd /root/media-manager
nohup python3 app.py > media-manager.log 2>&1 &
```

#### 2. 查看日志
```bash
tail -f /root/media-manager/media-manager.log
```

#### 3. 查看进程
```bash
ps aux | grep app.py
```

#### 4. 停止服务
```bash
pkill -f app.py
```

---

### 方法三：使用systemd服务（最推荐）

#### 1. 创建服务文件
```bash
nano /etc/systemd/system/media-manager.service
```

#### 2. 添加以下内容
```ini
[Unit]
Description=Media Manager Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/media-manager
ExecStart=/usr/bin/python3 /root/media-manager/app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 3. 启用并启动服务
```bash
# 重载systemd配置
systemctl daemon-reload

# 启动服务
systemctl start media-manager

# 设置开机自启
systemctl enable media-manager

# 查看服务状态
systemctl status media-manager

# 查看日志
journalctl -u media-manager -f
```

#### 4. 服务管理命令
```bash
# 启动服务
systemctl start media-manager

# 停止服务
systemctl stop media-manager

# 重启服务
systemctl restart media-manager

# 查看状态
systemctl status media-manager

# 禁用开机自启
systemctl disable media-manager
```

---

## 🔧 故障排除

### 问题1：端口被占用
```bash
# 查看8090端口是否被占用
netstat -tulpn | grep 8090

# 或使用
lsof -i :8090

# 如果被占用，可以修改app.py中的PORT变量
```

### 问题2：权限不足
```bash
# 确保有权限访问扫描路径
ls -la /vol02/1000-1-b23abde7/待整理

# 如果没有权限，添加权限
chmod 755 /vol02/1000-1-b23abde7/待整理
```

### 问题3：Python版本问题
```bash
# 检查Python版本
python3 --version

# 如果版本太低，Debian 12应该自带Python 3.11+
```

### 问题4：无法访问Web界面
```bash
# 检查防火墙
iptables -L -n | grep 8090

# 如果需要开放端口（飞牛OS通常不需要）
iptables -A INPUT -p tcp --dport 8090 -j ACCEPT
```

### 问题5：网盘挂载问题
```bash
# 检查网盘是否正常挂载
ls -la /vol02/1000-1-b23abde7/

# 检查挂载点
mount | grep vol02
```

---

## 📱 使用方法

1. 在浏览器中访问：`http://你的NAS_IP:8090`
2. 点击"🚀 开始智能重命名"按钮
3. 等待扫描和重命名完成
4. 查看重命名日志

---

## 🔄 更新程序

```bash
# 停止服务
systemctl stop media-manager
# 或
pkill -f app.py

# 上传新的文件覆盖旧文件
scp app.py root@你的NAS_IP:/root/media-manager/
scp index.html root@你的NAS_IP:/root/media-manager/

# 重启服务
systemctl start media-manager
# 或
cd /root/media-manager && nohup python3 app.py > media-manager.log 2>&1 &
```

---

## 📝 注意事项

1. **备份重要文件**：重命名操作不可逆，建议先备份
2. **网络稳定**：115网盘操作需要稳定的网络连接
3. **耐心等待**：网盘操作较慢，大量文件可能需要较长时间
4. **定期检查**：建议定期查看日志，确保服务正常运行

---

## 🎯 快速命令参考

```bash
# 一键部署（复制粘贴执行）
mkdir -p /root/media-manager && cd /root/media-manager

# 启动服务
python3 app.py

# 后台运行
nohup python3 app.py > media-manager.log 2>&1 &

# 查看日志
tail -f media-manager.log

# 停止服务
pkill -f app.py

# 查看进程
ps aux | grep app.py
```

---

## 📞 支持

如有问题，请检查：
1. 日志文件：`/root/media-manager/media-manager.log`
2. 系统日志：`journalctl -u media-manager -f`
3. Python错误：直接运行 `python3 app.py` 查看错误信息
