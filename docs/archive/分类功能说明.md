# 智能分类功能说明

## 功能概述

媒体文件管理器现在支持基于TMDB元数据的智能分类功能，可以自动将电影和电视剧分类到不同的子目录中。

## 使用方法

### 1. 配置路径

在界面上配置三个路径：
- **📂 扫描路径**：待整理的媒体文件所在目录
- **🎬 电影输出路径**：电影文件的输出目标目录
- **📺 电视剧输出路径**：电视剧文件的输出目标目录

### 2. 自动分类

点击"一键智能重命名"后，系统会：
1. 查询TMDB获取完整元数据（genre_ids, origin_country, original_language）
2. 根据分类规则自动匹配分类
3. 将文件移动到对应的输出路径下的分类子目录

## 分类规则

### 电影分类

| 分类名 | 匹配规则 |
|--------|----------|
| **动画电影** | genre_ids 包含 16（动画） |
| **华语电影** | original_language 为 zh, cn, bo, za |
| **外语电影** | 默认分类（未匹配以上规则） |

### 电视剧分类

| 分类名 | 匹配规则 |
|--------|----------|
| **国漫** | genre_ids=16 且 origin_country 为 CN/TW/HK |
| **日番** | genre_ids=16 且 origin_country 为 JP |
| **纪录片** | genre_ids 包含 99 |
| **儿童** | genre_ids 包含 10762 |
| **综艺** | genre_ids 包含 10764 或 10767 |
| **国产剧** | origin_country 为 CN/TW/HK |
| **欧美剧** | origin_country 为 US/FR/GB/DE/ES/IT/NL/PT/RU/UK |
| **日韩剧** | origin_country 为 JP/KP/KR/TH/IN/SG |
| **未分类** | 默认分类（未匹配以上规则） |

## 示例

### 输入
```
扫描路径: /vol02/待整理/
电影输出路径: /vol02/电影/
电视剧输出路径: /vol02/电视剧/

文件: Apocalypse Bringer Mynoghra.S01E01.mkv
```

### 处理流程
1. 识别为电视剧（S01E01）
2. 查询TMDB获取元数据：
   - 中文标题：异世界默示录麦诺格拉
   - genre_ids: [16]（动画）
   - origin_country: ['JP']（日本）
3. 匹配分类规则：**日番**
4. 生成目标路径：`/vol02/电视剧/日番/异世界默示录麦诺格拉 (2025)/Season 1/异世界默示录麦诺格拉 - S01E01.mkv`

### 输出结构
```
/vol02/电视剧/
├── 日番/
│   └── 异世界默示录麦诺格拉 (2025)/
│       └── Season 1/
│           └── 异世界默示录麦诺格拉 - S01E01.mkv
├── 国产剧/
├── 欧美剧/
└── 未分类/

/vol02/电影/
├── 动画电影/
├── 华语电影/
└── 外语电影/
```

## TMDB 元数据字典

### genre_ids（类型ID）
- 28 - 动作
- 12 - 冒险
- 16 - 动画
- 35 - 喜剧
- 80 - 犯罪
- 99 - 纪录
- 18 - 剧情
- 10751 - 家庭
- 14 - 奇幻
- 27 - 恐怖
- 10762 - 儿童
- 10764 - 综艺（真人秀）
- 10767 - 综艺（脱口秀）

### origin_country（国家/地区）
- CN - 中国大陆
- TW - 中国台湾
- HK - 中国香港
- JP - 日本
- KR - 韩国
- US - 美国
- GB - 英国
- FR - 法国
- DE - 德国

### original_language（原始语言）
- zh - 中文
- cn - 中文
- en - 英语
- ja - 日语
- ko - 韩语

## 注意事项

1. **中文标题无法自动分类**：如果文件名已经是中文，系统无法查询TMDB元数据，将使用默认分类
2. **查询失败**：如果TMDB和豆瓣都查询失败，将使用默认分类
3. **网盘操作**：移动文件到不同目录可能需要较长时间，请耐心等待
4. **目录自动创建**：分类目录会自动创建，无需手动创建

## 自定义分类规则

如需修改分类规则，请编辑 `app.py` 中的 `CATEGORY_CONFIG` 配置：

```python
CATEGORY_CONFIG = {
    'movie': {
        '动画电影': {
            'genre_ids': ['16']
        },
        '华语电影': {
            'original_language': ['zh', 'cn', 'bo', 'za']
        },
        '外语电影': {}  # 默认分类
    },
    'tv': {
        # ... 电视剧分类规则
    }
}
```

修改后需要重启服务器。
