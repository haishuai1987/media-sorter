# Media Renamer v2.8.0 éƒ¨ç½²æ‰‹å†Œ

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### æœ€ä½è¦æ±‚
- **Python**: 3.7+
- **å†…å­˜**: 512MB
- **ç£ç›˜**: 100MBï¼ˆåº”ç”¨ï¼‰
- **æµè§ˆå™¨**: Chrome/Firefox/Safari/Edgeï¼ˆç°ä»£æµè§ˆå™¨ï¼‰

### æ¨èé…ç½®
- **Python**: 3.9+
- **å†…å­˜**: 1GB+
- **ç£ç›˜**: 500MB+
- **CPU**: 2æ ¸+

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹æ³•1ï¼šæœ¬åœ°éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/haishuai1987/media-sorter.git
cd media-sorter

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-v2.8.0.txt

# 3. å¯åŠ¨åº”ç”¨
python app_v2.py

# 4. è®¿é—®åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8090
```

### æ–¹æ³•2ï¼šDocker éƒ¨ç½²

```bash
# ä½¿ç”¨ Docker Compose
docker-compose up -d

# è®¿é—®åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8090
```

---

## ğŸ³ Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰

#### 1. åˆ›å»º docker-compose.yml

```yaml
version: '3.8'

services:
  media-renamer:
    build: .
    ports:
      - "8090:8090"
    volumes:
      - ./data:/app/data
      - ./config:/app/config
    environment:
      - PORT=8090
      - HOST=0.0.0.0
    restart: unless-stopped
```

#### 2. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

### ä½¿ç”¨ Docker å‘½ä»¤

```bash
# æ„å»ºé•œåƒ
docker build -t media-renamer:v2.8.0 .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name media-renamer \
  -p 8090:8090 \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/config:/app/config \
  -e PORT=8090 \
  media-renamer:v2.8.0

# æŸ¥çœ‹æ—¥å¿—
docker logs -f media-renamer

# åœæ­¢å®¹å™¨
docker stop media-renamer

# åˆ é™¤å®¹å™¨
docker rm media-renamer
```

---

## ğŸ’» æœ¬åœ°éƒ¨ç½²

### Linux/macOS

#### 1. å®‰è£… Python

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip

# CentOS/RHEL
sudo yum install python3 python3-pip

# macOS (ä½¿ç”¨ Homebrew)
brew install python3
```

#### 2. å…‹éš†å’Œå®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/haishuai1987/media-sorter.git
cd media-sorter

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-v2.8.0.txt
```

#### 3. å¯åŠ¨åº”ç”¨

```bash
# é»˜è®¤ç«¯å£ 8090
python app_v2.py

# è‡ªå®šä¹‰ç«¯å£
python app_v2.py --port 8091

# åå°è¿è¡Œ
nohup python app_v2.py > app.log 2>&1 &
```

### Windows

#### 1. å®‰è£… Python

ä» [python.org](https://www.python.org/downloads/) ä¸‹è½½å¹¶å®‰è£… Python 3.7+

#### 2. å…‹éš†å’Œå®‰è£…

```powershell
# å…‹éš†ä»“åº“
git clone https://github.com/haishuai1987/media-sorter.git
cd media-sorter

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv
venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-v2.8.0.txt
```

#### 3. å¯åŠ¨åº”ç”¨

```powershell
# é»˜è®¤ç«¯å£ 8090
python app_v2.py

# è‡ªå®šä¹‰ç«¯å£
python app_v2.py --port 8091
```

---

## â˜ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²

### Ubuntu Server

#### 1. å‡†å¤‡æœåŠ¡å™¨

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y python3 python3-pip git nginx
```

#### 2. éƒ¨ç½²åº”ç”¨

```bash
# å…‹éš†ä»“åº“
cd /opt
sudo git clone https://github.com/haishuai1987/media-sorter.git
cd media-renamer

# å®‰è£…ä¾èµ–
sudo pip3 install -r requirements.txt
sudo pip3 install -r requirements-v2.8.0.txt
```

#### 3. é…ç½®ç³»ç»ŸæœåŠ¡

åˆ›å»º `/etc/systemd/system/media-renamer.service`ï¼š

```ini
[Unit]
Description=Media Renamer Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/media-renamer
Environment="PATH=/usr/bin"
ExecStart=/usr/bin/python3 /opt/media-renamer/app_v2.py --host 0.0.0.0 --port 8090
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡è½½é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start media-renamer

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable media-renamer

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status media-renamer

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u media-renamer -f
```

#### 4. é…ç½® Nginx åå‘ä»£ç†

åˆ›å»º `/etc/nginx/sites-available/media-renamer`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8090;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/media-renamer /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

#### 5. é…ç½® SSLï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `PORT` | ç›‘å¬ç«¯å£ | 8090 |
| `HOST` | ç›‘å¬åœ°å€ | 0.0.0.0 |
| `DEBUG` | è°ƒè¯•æ¨¡å¼ | False |

### å‘½ä»¤è¡Œå‚æ•°

```bash
python app_v2.py --help

é€‰é¡¹:
  --host HOST       ç›‘å¬åœ°å€ (é»˜è®¤: 0.0.0.0)
  --port PORT       ç›‘å¬ç«¯å£ (é»˜è®¤: 8090)
  --debug           å¯ç”¨è°ƒè¯•æ¨¡å¼
```

### é…ç½®æ–‡ä»¶

åº”ç”¨é…ç½®å­˜å‚¨åœ¨ `data/configs/` ç›®å½•ï¼š

```
data/
â”œâ”€â”€ configs/          # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ configs.json
â””â”€â”€ history.db        # å†å²è®°å½•æ•°æ®åº“
```

---

## ğŸ”’ å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian (UFW)
sudo ufw allow 8090/tcp
sudo ufw enable

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=8090/tcp
sudo firewall-cmd --reload
```

### 2. åå‘ä»£ç†è®¤è¯

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ åŸºæœ¬è®¤è¯ï¼š

```nginx
location / {
    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
    
    proxy_pass http://127.0.0.1:8090;
    # ... å…¶ä»–é…ç½®
}
```

åˆ›å»ºå¯†ç æ–‡ä»¶ï¼š

```bash
sudo apt install apache2-utils
sudo htpasswd -c /etc/nginx/.htpasswd admin
```

### 3. HTTPS é…ç½®

ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼ˆè§ä¸Šæ–‡ SSL é…ç½®ï¼‰

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨ Gunicornï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

```bash
# å®‰è£… Gunicorn
pip install gunicorn

# å¯åŠ¨åº”ç”¨
gunicorn -w 4 -b 0.0.0.0:8090 app_v2:app

# ä½¿ç”¨é…ç½®æ–‡ä»¶
gunicorn -c gunicorn.conf.py app_v2:app
```

åˆ›å»º `gunicorn.conf.py`ï¼š

```python
bind = "0.0.0.0:8090"
workers = 4
worker_class = "eventlet"  # æ”¯æŒ WebSocket
timeout = 120
keepalive = 5
```

### 2. æ•°æ®åº“ä¼˜åŒ–

SQLite é…ç½®ï¼ˆ`data/history.db`ï¼‰ï¼š

```python
# åœ¨åº”ç”¨ä¸­é…ç½®
PRAGMA journal_mode = WAL;
PRAGMA synchronous = NORMAL;
PRAGMA cache_size = 10000;
```

### 3. é™æ€æ–‡ä»¶ç¼“å­˜

Nginx é…ç½®ï¼š

```nginx
location /static/ {
    alias /opt/media-renamer/public/;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

---

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
# åº”ç”¨æ—¥å¿—
tail -f app.log

# ç³»ç»ŸæœåŠ¡æ—¥å¿—
sudo journalctl -u media-renamer -f

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### ç›‘æ§æŒ‡æ ‡

- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ I/O
- ç½‘ç»œæµé‡
- å“åº”æ—¶é—´

---

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°åº”ç”¨

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop media-renamer

# æ‹‰å–æœ€æ–°ä»£ç 
cd /opt/media-renamer
sudo git pull origin main

# æ›´æ–°ä¾èµ–
sudo pip3 install -r requirements.txt -U
sudo pip3 install -r requirements-v2.8.0.txt -U

# å¯åŠ¨æœåŠ¡
sudo systemctl start media-renamer
```

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½é…ç½®å’Œæ•°æ®
tar -czf backup-$(date +%Y%m%d).tar.gz data/

# æ¢å¤å¤‡ä»½
tar -xzf backup-20231023.tar.gz
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :8090
sudo netstat -tulpn | grep 8090

# æ›´æ¢ç«¯å£
python app_v2.py --port 8091
```

#### 2. ä¾èµ–å®‰è£…å¤±è´¥

```bash
# å‡çº§ pip
pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 3. æƒé™é—®é¢˜

```bash
# ä¿®æ”¹æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /opt/media-renamer
sudo chmod -R 755 /opt/media-renamer
```

#### 4. WebSocket è¿æ¥å¤±è´¥

æ£€æŸ¥ Nginx é…ç½®æ˜¯å¦æ”¯æŒ WebSocketï¼š

```nginx
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection 'upgrade';
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](./å¿«é€Ÿå¼€å§‹.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [ä½¿ç”¨æ‰‹å†Œ](./ä½¿ç”¨æ‰‹å†Œ.md) - å®Œæ•´åŠŸèƒ½è¯´æ˜
- [å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md) - é—®é¢˜è§£ç­”
- [API æ–‡æ¡£](./APIæ–‡æ¡£.md) - API æ¥å£è¯´æ˜

---

**éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®åº”ç”¨å¼€å§‹ä½¿ç”¨ï¼** ğŸ‰
