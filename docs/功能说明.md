# 功能说明

## 目录
- [智能重命名](#智能重命名)
- [中文标题识别](#中文标题识别)
- [智能去重](#智能去重)
- [智能分类](#智能分类)
- [冲突处理](#冲突处理)
- [自动清理](#自动清理)
- [整理详情](#整理详情)
- [设置功能](#设置功能)

---

## 智能重命名

### 功能概述

自动识别媒体文件信息并生成标准化文件名。

### 识别内容

- **电影/剧集名称**: 从文件名或文件夹名提取
- **年份**: 识别4位数字年份
- **季集信息**: 识别S01E01, 1x01等格式
- **分辨率**: 4K, 2160p, 1080p, 720p, 480p
- **来源**: BluRay, WEB-DL, HDTV, REMUX等
- **编码**: H.265, H.264, x265, x264
- **语言**: chs, eng, chi, cht等

### 命名格式

#### 电影
```
电影名称 (年份) [分辨率-来源].扩展名
```

#### 剧集
```
剧集名称 (年份)/Season XX/剧集名称 - SXXEXX [分辨率-来源].扩展名
```

### 示例

**输入**:
```
The.Wandering.Earth.2019.1080p.BluRay.x264.mkv
```

**输出**:
```
流浪地球 (2019) [1080p-BluRay].mkv
```

---

## 中文标题识别

### 功能概述

通过豆瓣和TMDB API获取中文标题，自动翻译英文标题。

### 查询流程

1. **豆瓣查询**（优先）
   - 提供中文标题
   - 提供中文简介
   - 不需要代理
   - 速度较快

2. **TMDB查询**（备用）
   - 提供英文标题
   - 自动翻译为中文
   - 可能需要代理
   - 数据更全面

### 配置要求

#### 豆瓣
- **Cookie**: 必需
- **获取方法**: 登录豆瓣 → F12 → Network → 复制Cookie
- **有效期**: 1-3个月
- **代理**: 不需要

#### TMDB
- **API Key**: 必需
- **获取方法**: https://www.themoviedb.org/settings/api
- **限制**: 每天40,000次请求
- **代理**: 可能需要（国内）

### 示例

**英文标题**: The Shawshank Redemption
**豆瓣结果**: 肖申克的救赎
**TMDB结果**: 肖申克的救赎（翻译）

---

## 智能去重

### 功能概述

自动识别重复文件，保留最佳质量版本，删除低质量版本。

### 质量评分系统

#### 分辨率基础分
- 4K/2160p: 2160分
- 1080p: 1080分
- 720p: 720分
- 480p: 480分
- 360p: 360分

#### 来源质量加分
- REMUX: +100分
- BluRay: +80分
- WEB-DL: +60分
- WEBRip: +40分
- HDRip: +20分
- HDTV: +10分

#### 格式加分
- MKV: +5分
- MP4: +3分
- AVI: +1分

#### 编码加分
- H.265/HEVC: +2分
- H.264: +1分

### 去重规则

1. **识别重复**: 相同电影/剧集的不同版本
2. **计算分数**: 使用质量评分系统
3. **保留最佳**: 保留总分最高的版本
4. **删除其他**: 删除低分版本

### 示例

**文件1**: 流浪地球.2019.720p.WEB-DL.mkv
- 分辨率: 720
- 来源: +60
- 格式: +5
- **总分: 785**

**文件2**: 流浪地球.2019.1080p.BluRay.mkv
- 分辨率: 1080
- 来源: +80
- 格式: +5
- **总分: 1165**

**结果**: 保留文件2，删除文件1

---

## 智能分类

### 功能概述

根据元数据自动分类电影和剧集。

### 电影分类

#### 动画电影
- **规则**: 类型包含"动画"
- **示例**: 千与千寻、疯狂动物城

#### 华语电影
- **规则**: 原始语言为中文（zh, cn, bo, za）
- **示例**: 流浪地球、让子弹飞

#### 外语电影
- **规则**: 其他语言
- **示例**: 肖申克的救赎、阿甘正传

### 剧集分类

#### 国漫
- **规则**: 动画 + 中国/台湾/香港
- **示例**: 一人之下、刺客伍六七

#### 日番
- **规则**: 动画 + 日本
- **示例**: 进击的巨人、鬼灭之刃

#### 纪录片
- **规则**: 类型为纪录片
- **示例**: 舌尖上的中国、地球脉动

#### 国产剧
- **规则**: 中国/台湾/香港剧集
- **示例**: 三体、庆余年

#### 日韩剧
- **规则**: 日本/韩国剧集
- **示例**: 半泽直树、鱿鱼游戏

#### 欧美剧
- **规则**: 欧美国家剧集
- **示例**: 权力的游戏、绝命毒师

### 目录结构

```
电影/
├── 动画电影/
│   └── 千与千寻 (2001) [1080p-BluRay].mkv
├── 华语电影/
│   └── 流浪地球 (2019) [1080p-BluRay].mkv
└── 外语电影/
    └── 肖申克的救赎 (1994) [1080p-BluRay].mkv

剧集/
├── 国漫/
│   └── 一人之下 (2016)/Season 01/...
├── 日番/
│   └── 进击的巨人 (2013)/Season 01/...
└── 国产剧/
    └── 三体 (2023)/Season 01/...
```

---

## 冲突处理

### 功能概述

处理同名文件冲突，提供多种策略。

### 策略说明

#### 自动比较（推荐）
- **规则**: 智能比较文件质量
- **新文件更好**: 替换旧文件
- **旧文件更好**: 保留旧文件
- **质量相同**: 保留旧文件

#### 跳过
- **规则**: 保留旧文件，跳过新文件
- **适用**: 不想覆盖已有文件

#### 替换
- **规则**: 用新文件替换旧文件
- **适用**: 确定新文件更好

#### 保留两个
- **规则**: 新文件添加.v1后缀
- **适用**: 想保留多个版本

### 处理流程

```
1. 检测冲突
   ↓
2. 应用策略
   ↓
3. 执行操作
   ↓
4. 记录日志
```

### 示例

#### 场景1: 自动比较
```
旧: 流浪地球 (2019) [720p-WEB-DL].mkv (785分)
新: 流浪地球 (2019) [1080p-BluRay].mkv (1165分)
结果: 删除旧文件，保留新文件
```

#### 场景2: 保留两个
```
旧: 流浪地球 (2019) [1080p-BluRay].mkv
新: 流浪地球 (2019) [1080p-WEB-DL].mkv
结果:
- 流浪地球 (2019) [1080p-BluRay].mkv
- 流浪地球 (2019) [1080p-WEB-DL].v1.mkv
```

---

## 自动清理

### 功能概述

自动清理跳过的文件和空文件夹，释放磁盘空间。

### 清理内容

#### 跳过的文件
- 质量相同或较差的文件
- 冲突时被跳过的文件
- 自动删除

#### 空文件夹
- 递归检查所有文件夹
- 从底层向上删除
- 保持目录整洁

### 清理时机

- 所有文件处理完成后
- 自动执行
- 无需手动操作

### 清理流程

```
1. 收集跳过的文件列表
   ↓
2. 删除跳过的文件
   ↓
3. 扫描空文件夹
   ↓
4. 递归删除空文件夹
   ↓
5. 生成清理报告
```

### 示例

**清理前**:
```
待整理/
├── 电影A/
│   ├── 电影A.720p.mkv (跳过)
│   └── 电影A.1080p.mkv (已移动)
└── 电影B/
    └── 电影B.mkv (已移动)
```

**清理后**:
```
待整理/
(空目录，所有文件已处理)
```

---

## 整理详情

### 功能概述

实时显示整理进度和详细日志。

### 界面组成

#### 整体进度
- 进度条（0-100%）
- 百分比显示
- 状态文字

#### 当前步骤
- 步骤图标
- 步骤名称
- 详细说明
- 脉冲动画

#### 详细进度
- 8个步骤列表
- 三种状态：等待中、进行中、已完成
- 颜色区分

#### 实时日志
- 终端风格
- 绿色文字
- 时间戳
- 自动滚动

### 8个处理步骤

1. **📂 智能扫描** - 扫描待整理目录
2. **🌐 中文标题识别** - 获取中文标题
3. **🎯 智能去重** - 识别并删除重复
4. **📝 标准化重命名** - 生成标准文件名
5. **📁 智能分类** - 自动分类
6. **🚚 自动移动** - 移动到目标目录
7. **⚔️ 冲突处理** - 处理同名文件
8. **🧹 自动清理** - 清理和整理

### 使用方式

#### 实时监控
1. 点击"一键整理入库"
2. 立即点击"整理详情"
3. 实时查看进度

#### 后台处理
1. 点击"一键整理入库"
2. 不打开详情弹窗
3. 完成后自动通知

### 完成通知

#### 弹窗内
- 显示完成状态
- 100%进度
- 所有步骤完成

#### 弹窗外
- 右上角滑入通知
- 5秒后自动消失
- 点击查看详情

---

## 设置功能

### 功能概述

独立配置API密钥和代理，避免共享导致的限制。

### 配置项

#### TMDB配置
- **API Key**: TMDB API密钥
- **代理地址**: http://proxy:port
- **代理类型**: HTTP/HTTPS 或 SOCKS5

#### 豆瓣配置
- **Cookie**: 豆瓣Cookie

### 配置文件

**位置**: `~/.media-renamer/config.json`

**格式**:
```json
{
  "tmdb_api_key": "your-key",
  "tmdb_proxy": "http://proxy:port",
  "tmdb_proxy_type": "http",
  "douban_cookie": "your-cookie"
}
```

### 使用场景

#### 个人使用
- 使用自己的API配额
- 避免被风控
- 独立的访问记录

#### 分享给朋友
- 每个用户配置自己的密钥
- 不会消耗他人配额
- 互不影响

#### 多设备使用
- 每个设备独立配置
- 配置保存在本地
- 灵活性高

### 安全建议

- Cookie包含登录信息，不要分享
- API Key是个人凭证，不要公开
- 定期更新Cookie
- 只使用可信的代理

---

## 总结

所有功能协同工作，提供完整的媒体库管理解决方案：

1. **智能重命名** - 标准化文件名
2. **中文标题识别** - 获取准确标题
3. **智能去重** - 保留最佳版本
4. **智能分类** - 自动组织文件
5. **冲突处理** - 灵活处理冲突
6. **自动清理** - 保持整洁
7. **整理详情** - 实时监控
8. **设置功能** - 独立配置

一键操作，自动完成所有步骤！
