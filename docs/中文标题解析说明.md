# ä¸­æ–‡æ ‡é¢˜è§£æè¯´æ˜

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

**æ‰€æœ‰éä¸­æ–‡æ ‡é¢˜éƒ½å¿…é¡»è½¬æ¢ä¸ºä¸­æ–‡æ ‡é¢˜ï¼**

---

## ğŸ“‹ é—®é¢˜è¯´æ˜

### ä¹‹å‰çš„é—®é¢˜

**é«˜çº§è¯†åˆ«å™¨åªæå–æ–‡ä»¶åä¸­çš„ä¿¡æ¯ï¼Œä¸æŸ¥è¯¢ä¸­æ–‡æ ‡é¢˜ï¼š**

```
è¾“å…¥: The.Wandering.Earth.2019.1080p.BluRay.x264.AAC-RARBG.mkv
è¾“å‡º: æ ‡é¢˜ = "The Wandering Earth"  âŒ è¿™æ˜¯è‹±æ–‡ï¼

è¾“å…¥: Avengers.Endgame.2019.4K.UHD.BluRay.REMUX.HDR10+.mkv
è¾“å‡º: æ ‡é¢˜ = "Avengers Endgame"  âŒ è¿™æ˜¯è‹±æ–‡ï¼
```

### æ­£ç¡®çš„åšæ³•

**é«˜çº§è¯†åˆ«å™¨ + ä¸­æ–‡æ ‡é¢˜è§£æå™¨ = å®Œæ•´è§£å†³æ–¹æ¡ˆï¼š**

```
è¾“å…¥: The.Wandering.Earth.2019.1080p.BluRay.x264.AAC-RARBG.mkv
æ­¥éª¤ 1: é«˜çº§è¯†åˆ« â†’ "The Wandering Earth"
æ­¥éª¤ 2: æŸ¥è¯¢ TMDB/è±†ç“£ â†’ "æµæµªåœ°çƒ"  âœ“
è¾“å‡º: æµæµªåœ°çƒ (2019)/æµæµªåœ°çƒ (2019) [1080p-BluRay].mkv

è¾“å…¥: Avengers.Endgame.2019.4K.UHD.BluRay.REMUX.HDR10+.mkv
æ­¥éª¤ 1: é«˜çº§è¯†åˆ« â†’ "Avengers Endgame"
æ­¥éª¤ 2: æŸ¥è¯¢ TMDB/è±†ç“£ â†’ "å¤ä»‡è€…è”ç›Ÿ4ï¼šç»ˆå±€ä¹‹æˆ˜"  âœ“
è¾“å‡º: å¤ä»‡è€…è”ç›Ÿ4ï¼šç»ˆå±€ä¹‹æˆ˜ (2019)/å¤ä»‡è€…è”ç›Ÿ4ï¼šç»ˆå±€ä¹‹æˆ˜ (2019) [4K-BluRay].mkv
```

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. ä¸­æ–‡æ ‡é¢˜è§£æå™¨

**æ–‡ä»¶**: `core/chinese_title_resolver.py`

**åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹æ ‡é¢˜æ˜¯å¦ä¸ºä¸­æ–‡
- âœ… è‹±æ–‡æ ‡é¢˜è‡ªåŠ¨æŸ¥è¯¢ TMDB/è±†ç“£
- âœ… ä¼˜å…ˆä½¿ç”¨è±†ç“£ï¼ˆä¸­æ–‡ç»“æœæ›´å‡†ç¡®ï¼‰
- âœ… è±†ç“£å¤±è´¥æ—¶ä½¿ç”¨ TMDB
- âœ… ç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œæé«˜æ€§èƒ½

### 2. é›†æˆè¯†åˆ«å™¨

**ç±»**: `IntegratedRecognizer`

**åŠŸèƒ½**ï¼š
- âœ… æ•´åˆé«˜çº§è¯†åˆ«å™¨ + ä¸­æ–‡æ ‡é¢˜è§£æå™¨
- âœ… ä¸€æ­¥å®Œæˆï¼šè¯†åˆ« + ä¸­æ–‡æ ‡é¢˜æŸ¥è¯¢
- âœ… ä¿ç•™åŸå§‹è‹±æ–‡æ ‡é¢˜ï¼ˆ`original_title` å­—æ®µï¼‰

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```python
from core.chinese_title_resolver import IntegratedRecognizer

# åˆ›å»ºè¯†åˆ«å™¨ï¼ˆéœ€è¦é…ç½® APIï¼‰
recognizer = IntegratedRecognizer(
    tmdb_api_key="YOUR_TMDB_API_KEY",
    douban_cookie="YOUR_DOUBAN_COOKIE"
)

# è¯†åˆ«æ–‡ä»¶ï¼ˆè‡ªåŠ¨è·å–ä¸­æ–‡æ ‡é¢˜ï¼‰
filename = "The.Matrix.1999.1080p.BluRay.x264.DTS.mkv"
info = recognizer.recognize_with_chinese_title(filename)

print(f"æ ‡é¢˜: {info['title']}")  # é»‘å®¢å¸å›½
print(f"åŸå§‹æ ‡é¢˜: {info.get('original_title')}")  # The Matrix
print(f"å¹´ä»½: {info['year']}")  # 1999
```

### å®Œæ•´æµç¨‹

```python
from core.chinese_title_resolver import IntegratedRecognizer
from core.template_engine import get_template_engine

# 1. åˆ›å»ºè¯†åˆ«å™¨
recognizer = IntegratedRecognizer(
    tmdb_api_key=TMDB_API_KEY,
    douban_cookie=DOUBAN_COOKIE
)

# 2. è¯†åˆ«æ–‡ä»¶ï¼ˆè‡ªåŠ¨è·å–ä¸­æ–‡æ ‡é¢˜ï¼‰
filename = "The.Wandering.Earth.2019.1080p.BluRay.x264.AAC.mkv"
info = recognizer.recognize_with_chinese_title(filename)

# 3. ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæ–°æ–‡ä»¶å
engine = get_template_engine()
new_name = engine.render('movie_default', {
    'title': info['title'],  # æµæµªåœ°çƒï¼ˆä¸­æ–‡ï¼‰
    'year': info['year'],
    'resolution': info['resolution'],
    'source': info['source'],
    'ext': 'mkv',
})

print(new_name)
# è¾“å‡º: æµæµªåœ°çƒ (2019)/æµæµªåœ°çƒ (2019) [1080p-BluRay].mkv
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å…¥æ–‡ä»¶å                                              â”‚
â”‚  The.Wandering.Earth.2019.1080p.BluRay.x264.AAC.mkv    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: é«˜çº§è¯†åˆ«å™¨                                      â”‚
â”‚  - æå–æ ‡é¢˜: "The Wandering Earth"                      â”‚
â”‚  - æå–å¹´ä»½: 2019                                       â”‚
â”‚  - æå–åˆ†è¾¨ç‡: 1080p                                    â”‚
â”‚  - æå–æ¥æº: BluRay                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: æ£€æµ‹æ ‡é¢˜è¯­è¨€                                    â”‚
â”‚  - æ£€æµ‹åˆ°è‹±æ–‡æ ‡é¢˜                                        â”‚
â”‚  - éœ€è¦æŸ¥è¯¢ä¸­æ–‡æ ‡é¢˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: æŸ¥è¯¢ä¸­æ–‡æ ‡é¢˜                                    â”‚
â”‚  - ä¼˜å…ˆæŸ¥è¯¢è±†ç“£: "The Wandering Earth" + 2019           â”‚
â”‚  - æ‰¾åˆ°ä¸­æ–‡æ ‡é¢˜: "æµæµªåœ°çƒ"                              â”‚
â”‚  - ä¿å­˜åŸå§‹æ ‡é¢˜: original_title = "The Wandering Earth" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæ–°æ–‡ä»¶å                            â”‚
â”‚  - æ¨¡æ¿: movie_default                                  â”‚
â”‚  - æ ‡é¢˜: æµæµªåœ°çƒï¼ˆä¸­æ–‡ï¼‰                                â”‚
â”‚  - å¹´ä»½: 2019                                           â”‚
â”‚  - åˆ†è¾¨ç‡: 1080p                                        â”‚
â”‚  - æ¥æº: BluRay                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾“å‡ºæ–‡ä»¶å                                              â”‚
â”‚  æµæµªåœ°çƒ (2019)/æµæµªåœ°çƒ (2019) [1080p-BluRay].mkv    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ç¤ºä¾‹å¯¹æ¯”

### ç¤ºä¾‹ 1: è‹±æ–‡ç”µå½±

| é˜¶æ®µ | å†…å®¹ |
|------|------|
| **è¾“å…¥** | `The.Matrix.1999.1080p.BluRay.x264.DTS.mkv` |
| **é«˜çº§è¯†åˆ«** | æ ‡é¢˜: "The Matrix", å¹´ä»½: 1999 |
| **ä¸­æ–‡æŸ¥è¯¢** | æŸ¥è¯¢ TMDB/è±†ç“£ â†’ "é»‘å®¢å¸å›½" |
| **è¾“å‡º** | `é»‘å®¢å¸å›½ (1999)/é»‘å®¢å¸å›½ (1999) [1080p-BluRay].mkv` |

### ç¤ºä¾‹ 2: è‹±æ–‡ç”µè§†å‰§

| é˜¶æ®µ | å†…å®¹ |
|------|------|
| **è¾“å…¥** | `Game.of.Thrones.S08E06.1080p.WEB-DL.H264.mkv` |
| **é«˜çº§è¯†åˆ«** | æ ‡é¢˜: "Game of Thrones", å­£: 8, é›†: 6 |
| **ä¸­æ–‡æŸ¥è¯¢** | æŸ¥è¯¢ TMDB/è±†ç“£ â†’ "æƒåŠ›çš„æ¸¸æˆ" |
| **è¾“å‡º** | `æƒåŠ›çš„æ¸¸æˆ/Season 08/æƒåŠ›çš„æ¸¸æˆ - S08E06 [1080p-WEB-DL].mkv` |

### ç¤ºä¾‹ 3: ä¸­æ–‡ç”µå½±ï¼ˆæ— éœ€æŸ¥è¯¢ï¼‰

| é˜¶æ®µ | å†…å®¹ |
|------|------|
| **è¾“å…¥** | `æµæµªåœ°çƒ.2019.1080p.BluRay.x264.AAC.mkv` |
| **é«˜çº§è¯†åˆ«** | æ ‡é¢˜: "æµæµªåœ°çƒ", å¹´ä»½: 2019 |
| **ä¸­æ–‡æ£€æµ‹** | âœ“ å·²ç»æ˜¯ä¸­æ–‡ï¼Œè·³è¿‡æŸ¥è¯¢ |
| **è¾“å‡º** | `æµæµªåœ°çƒ (2019)/æµæµªåœ°çƒ (2019) [1080p-BluRay].mkv` |

---

## âš™ï¸ é…ç½®è¦æ±‚

### TMDB API Key

1. è®¿é—® https://www.themoviedb.org/settings/api
2. æ³¨å†Œè´¦å·
3. ç”³è¯· API Keyï¼ˆå…è´¹ï¼‰
4. é…ç½®åˆ°ç¨‹åºä¸­

### è±†ç“£ Cookie

1. ç™»å½• https://movie.douban.com/
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. Network æ ‡ç­¾ â†’ åˆ·æ–°é¡µé¢
4. å¤åˆ¶ Cookie
5. é…ç½®åˆ°ç¨‹åºä¸­

---

## ğŸ¯ å…³é”®ç‚¹

### âœ… ä¼˜åŠ¿

1. **ç¡®ä¿ä¸­æ–‡æ ‡é¢˜** - æ‰€æœ‰è‹±æ–‡æ ‡é¢˜éƒ½ä¼šè‡ªåŠ¨è½¬æ¢
2. **æ™ºèƒ½æ£€æµ‹** - ä¸­æ–‡æ ‡é¢˜ä¸ä¼šé‡å¤æŸ¥è¯¢
3. **åŒé‡ä¿é™©** - è±†ç“£ + TMDB åŒé‡æŸ¥è¯¢
4. **ä¿ç•™åŸå§‹** - åŸå§‹è‹±æ–‡æ ‡é¢˜ä¿å­˜åœ¨ `original_title`
5. **æ€§èƒ½ä¼˜åŒ–** - æŸ¥è¯¢ç»“æœç¼“å­˜

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **éœ€è¦ç½‘ç»œ** - æŸ¥è¯¢ TMDB/è±†ç“£éœ€è¦ç½‘ç»œè¿æ¥
2. **éœ€è¦é…ç½®** - å¿…é¡»é…ç½® API Key å’Œ Cookie
3. **æŸ¥è¯¢å»¶è¿Ÿ** - é¦–æ¬¡æŸ¥è¯¢ä¼šæœ‰ç½‘ç»œå»¶è¿Ÿ
4. **å¤±è´¥å¤„ç†** - æŸ¥è¯¢å¤±è´¥æ—¶ä¿ç•™è‹±æ–‡æ ‡é¢˜

---

## ğŸ”— åœ¨ app.py ä¸­é›†æˆ

### ä¿®æ”¹ç°æœ‰ä»£ç 

```python
# åœ¨ app.py é¡¶éƒ¨æ·»åŠ å¯¼å…¥
from core.chinese_title_resolver import IntegratedRecognizer

# åˆ›å»ºå…¨å±€è¯†åˆ«å™¨å®ä¾‹
integrated_recognizer = None

def get_recognizer():
    """è·å–é›†æˆè¯†åˆ«å™¨"""
    global integrated_recognizer
    if integrated_recognizer is None:
        integrated_recognizer = IntegratedRecognizer(
            tmdb_api_key=TMDB_API_KEY,
            douban_cookie=DOUBAN_COOKIE
        )
    return integrated_recognizer

# åœ¨å¤„ç†æ–‡ä»¶æ—¶ä½¿ç”¨
def process_file(filename):
    recognizer = get_recognizer()
    
    # è‡ªåŠ¨è·å–ä¸­æ–‡æ ‡é¢˜
    info = recognizer.recognize_with_chinese_title(filename)
    
    # info['title'] ç°åœ¨æ˜¯ä¸­æ–‡æ ‡é¢˜
    # ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆæ–°æ–‡ä»¶å
    from core.template_engine import get_template_engine
    engine = get_template_engine()
    
    template = 'tv_default' if info['is_tv'] else 'movie_default'
    new_name = engine.render(template, {
        'title': info['title'],  # ä¸­æ–‡æ ‡é¢˜
        'year': info['year'],
        'season': info['season'],
        'episode': info['episode'],
        'resolution': info['resolution'],
        'source': info['source'],
        'ext': 'mkv',
    })
    
    return new_name
```

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test_chinese_title.py
```

---

## ğŸ“ æ€»ç»“

**å®Œæ•´è§£å†³æ–¹æ¡ˆ = é«˜çº§è¯†åˆ«å™¨ + ä¸­æ–‡æ ‡é¢˜è§£æå™¨ + æ¨¡æ¿å¼•æ“**

```
è‹±æ–‡æ–‡ä»¶å â†’ é«˜çº§è¯†åˆ« â†’ ä¸­æ–‡æŸ¥è¯¢ â†’ æ¨¡æ¿ç”Ÿæˆ â†’ ä¸­æ–‡æ–‡ä»¶å âœ“
```

**ç¡®ä¿æ‰€æœ‰æ ‡é¢˜æœ€ç»ˆéƒ½æ˜¯ä¸­æ–‡ï¼** ğŸ¯
