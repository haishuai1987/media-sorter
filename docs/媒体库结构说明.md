# 媒体库结构说明

## 概述

本文档详细说明媒体库的目录结构、命名规则和最佳实践。

---

## 标准目录结构

### 完整结构

```
媒体库根目录/
├── 电影/（或 Movies/）
│   ├── 动作/（或 Action/）
│   │   ├── 速度与激情9 (2021)/
│   │   │   └── 速度与激情9 (2021).mkv
│   │   └── 碟中谍7 (2023)/
│   │       └── 碟中谍7 (2023).mkv
│   ├── 喜剧/（或 Comedy/）
│   │   └── 你好，李焕英 (2021)/
│   │       └── 你好，李焕英 (2021).mkv
│   └── 科幻/（或 Sci-Fi/）
│       └── 沙丘 (2021)/
│           └── 沙丘 (2021).mkv
└── 电视剧/（或 TV Shows/）
    ├── 美剧/（或 US Drama/）
    │   └── 权力的游戏/
    │       ├── Season 01/
    │       │   ├── 权力的游戏 - S01E01 - 第 01 集.mkv
    │       │   └── 权力的游戏 - S01E02 - 第 02 集.mkv
    │       └── Season 02/
    │           └── 权力的游戏 - S02E01 - 第 01 集.mkv
    ├── 日剧/（或 Japanese Drama/）
    │   └── 半泽直树/
    │       └── Season 01/
    │           └── 半泽直树 - S01E01 - 第 01 集.mkv
    └── 韩剧/（或 Korean Drama/）
        └── 鱿鱼游戏/
            └── Season 01/
                └── 鱿鱼游戏 - S01E01 - 第 01 集.mkv
```

---

## 目录层级说明

### 第一层：媒体类型

**电影目录**：
- 中文：`电影`
- 英文：`Movies` 或 `Movie`

**电视剧目录**：
- 中文：`电视剧`
- 英文：`TV Shows`、`TV` 或 `Series`

**检测规则**：
- 系统会自动检测现有目录
- 优先使用中文名称
- 支持中英文混合

### 第二层：分类目录

**分类方式**：
1. **规则分类**：基于 TMDB 元数据自动分类
2. **目录检测**：检测现有分类目录，智能匹配

**内置分类规则**：

**电影分类**：
- **动画电影**：genre_ids 包含 16（动画）
- **华语电影**：语言为中文（zh, cn, bo, za）
- **外语电影**：其他语言（默认分类）

**电视剧分类**：
- **国漫**：动画（16）+ 中国/台湾/香港
- **日番**：动画（16）+ 日本
- **纪录片**：genre_ids 包含 99
- **儿童**：genre_ids 包含 10762
- **综艺**：genre_ids 包含 10764 或 10767
- **国产剧**：中国/台湾/香港
- **欧美剧**：美国/英国/法国/德国等
- **日韩剧**：日本/韩国/泰国/印度等
- **未分类**：其他（默认分类）

**自定义分类**：
- 支持自定义分类名称
- 支持中英文混合
- 系统会智能匹配现有分类
- 不存在的分类会自动创建

**分类优先级**：
1. 按配置顺序匹配规则
2. 匹配成功后使用该分类
3. 未匹配则使用默认分类

### 第三层：内容目录

**电影**：
```
电影名 (年份)/
└── 电影名 (年份).ext
```

**电视剧**：
```
剧名/
├── Season 01/
│   ├── 剧名 - S01E01 - 第 01 集.ext
│   └── 剧名 - S01E02 - 第 02 集.ext
└── Season 02/
    └── 剧名 - S02E01 - 第 01 集.ext
```

---

## 文件命名规则

### 电影文件名

**格式**：
```
电影名 (年份).ext
```

**示例**：
```
沙丘 (2021).mkv
速度与激情9 (2021).mp4
碟中谍7 (2023).mkv
```

**规则**：
- 使用中文标题（如果有）
- 包含年份信息
- 移除多余的质量信息（已在元数据中）

### 电视剧文件名

**格式**：
```
剧名 - S季E集 - 第 集 集.ext
```

**示例**：
```
权力的游戏 - S01E01 - 第 01 集.mkv
半泽直树 - S01E08 - 第 08 集.mkv
鱿鱼游戏 - S01E09 - 第 09 集.mp4
```

**规则**：
- 使用中文标题（如果有）
- 季集信息：S01E01 格式
- 集数标题：第 01 集
- 移除 Season 信息（已在目录中体现）

---

## 目录检测机制

### 自动检测

系统会自动检测媒体库中的：
1. 电影和电视剧目录
2. 现有的分类目录
3. 目录命名语言（中文/英文）

### 检测优先级

**电影目录**：
1. `电影` （最高优先级）
2. `Movies`
3. `Movie`

**电视剧目录**：
1. `电视剧` （最高优先级）
2. `TV Shows`
3. `TV`
4. `Series`

### 分类匹配

**精确匹配**：
- 分类名称完全相同（忽略大小写）
- 例：`动作` 匹配 `动作`

**模糊匹配**：
- 包含关系匹配
- 例：`Action` 匹配 `动作`
- 例：`US Drama` 匹配 `美剧`

---

## 最佳实践

### 1. 统一命名风格

**推荐**：
- 选择中文或英文，保持一致
- 使用系统的语言偏好设置

**不推荐**：
- 混合使用中英文（虽然支持）
- 频繁更改命名风格

### 2. 合理的分类粒度

**推荐**：
- 使用常见的分类（动作、喜剧、科幻等）
- 每个分类包含足够多的内容

**不推荐**：
- 过于细分的分类（如"科幻动作喜剧"）
- 只有一两个内容的分类

### 3. 保持目录整洁

**推荐**：
- 定期清理重复文件
- 使用智能去重功能
- 保持一致的文件格式

**不推荐**：
- 在媒体库根目录直接放文件
- 创建过多的临时文件夹

### 4. 备份重要内容

**推荐**：
- 定期备份媒体库配置
- 备份重要的媒体文件
- 使用版本控制（如果可能）

---

## 迁移现有媒体库

### 情况 1：无分类的媒体库

**现有结构**：
```
媒体库/
├── 电影/
│   ├── 沙丘 (2021).mkv
│   └── 速度与激情9 (2021).mkv
└── 电视剧/
    └── 权力的游戏 - S01E01.mkv
```

**迁移后**：
```
媒体库/
├── 电影/
│   ├── 科幻/
│   │   └── 沙丘 (2021)/
│   │       └── 沙丘 (2021).mkv
│   └── 动作/
│       └── 速度与激情9 (2021)/
│           └── 速度与激情9 (2021).mkv
└── 电视剧/
    └── 美剧/
        └── 权力的游戏/
            └── Season 01/
                └── 权力的游戏 - S01E01 - 第 01 集.mkv
```

### 情况 2：已有分类的媒体库

**现有结构**：
```
媒体库/
├── Movies/
│   ├── Action/
│   │   └── Fast & Furious 9 (2021).mkv
│   └── Sci-Fi/
│       └── Dune (2021).mkv
└── TV Shows/
    └── US Drama/
        └── Game of Thrones - S01E01.mkv
```

**系统行为**：
- 自动检测现有分类
- 使用现有的分类目录
- 保持现有的命名风格
- 新文件会放入匹配的分类

---

## 特殊情况处理

### 多版本文件

**场景**：同一电影有多个版本（4K、1080p等）

**处理方式**：
```
电影/
└── 动作/
    └── 速度与激情9 (2021)/
        ├── 速度与激情9 (2021).mkv          ← 4K版本
        └── 速度与激情9 (2021).v1.mkv       ← 1080p版本
```

### 特别篇/OVA

**场景**：电视剧的特别篇

**处理方式**：
```
电视剧/
└── 日剧/
    └── 半泽直树/
        ├── Season 01/
        │   └── 半泽直树 - S01E01 - 第 01 集.mkv
        └── Season 00/                      ← 特别篇
            └── 半泽直树 - S00E01 - 特别篇.mkv
```

### 电影合集

**场景**：系列电影

**处理方式**：
```
电影/
└── 动作/
    ├── 速度与激情1 (2001)/
    │   └── 速度与激情1 (2001).mkv
    ├── 速度与激情2 (2003)/
    │   └── 速度与激情2 (2003).mkv
    └── 速度与激情9 (2021)/
        └── 速度与激情9 (2021).mkv
```

---

## 性能优化

### 缓存机制

- 分类目录扫描结果会缓存
- 避免重复扫描文件系统
- 批量处理时复用检测器实例

### 建议

1. **避免过深的目录层级**
   - 推荐：3-4 层
   - 不推荐：5 层以上

2. **合理的文件数量**
   - 每个目录：建议 < 1000 个文件
   - 总文件数：根据系统性能调整

3. **使用 SSD**
   - 媒体库放在 SSD 上可提高性能
   - 特别是扫描和整理操作

---

## 常见问题

### Q1: 可以自定义分类名称吗？

**A**: 可以。在媒体库的电影或电视剧目录下手动创建分类文件夹，系统会自动检测并使用。

### Q2: 分类目录必须是中文或英文吗？

**A**: 不是。支持任何语言的分类名称，系统会智能匹配。

### Q3: 如何更改现有文件的分类？

**A**: 手动移动文件到新的分类目录，或重新整理文件。

### Q4: 系统如何决定文件的分类？

**A**: 根据 TMDB/豆瓣 的元数据中的类型信息自动分类。

### Q5: 可以禁用二级分类吗？

**A**: 可以。使用旧配置方式（分离的电影/电视剧路径），不会创建分类目录。

---

## 总结

合理的媒体库结构可以：
- 提高内容管理效率
- 方便内容查找和浏览
- 支持媒体服务器（Plex、Emby、Jellyfin）
- 提供更好的用户体验

建议遵循本文档的最佳实践，构建清晰、有序的媒体库。
