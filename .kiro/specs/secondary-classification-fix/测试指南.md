# 二级分类功能测试指南

## 测试环境
- 服务器已启动：`python app.py`
- 浏览器访问：`http://localhost:8000`

## 测试步骤

### 1. 测试媒体库路径配置

#### 步骤：
1. 打开浏览器，访问 `http://localhost:8000`
2. 在"媒体库路径"输入框中输入路径，例如：`/vol02/1000-1-b23abde7/115`
3. 点击 📁 按钮，测试文件夹浏览功能
4. 选择一个文件夹，确认路径正确填入

#### 预期结果：
- ✅ 文件夹浏览器正常打开
- ✅ 可以浏览文件夹
- ✅ 选择后路径正确填入输入框
- ✅ 路径保存到 localStorage

---

### 2. 测试媒体库结构检测

#### 步骤：
1. 在"媒体库路径"输入框中输入一个包含电影/电视剧目录的路径
2. 点击 🔍 检测按钮
3. 查看检测结果

#### 预期结果：
- ✅ 显示检测成功消息
- ✅ 显示电影目录名称（如果存在）
- ✅ 显示电视剧目录名称（如果存在）
- ✅ 显示电影分类列表（如果存在）
- ✅ 显示电视剧分类列表（如果存在）

#### 示例输出：
```
✓ 检测成功：
📁 电影目录: Movies
📁 电视剧目录: TV Shows
🎬 电影分类: 动作, 喜剧, 科幻
📺 电视剧分类: 美剧, 日剧, 韩剧
```

---

### 3. 测试语言偏好

#### 步骤：
1. 在"语言偏好"下拉框中选择"中文"或"English"
2. 保存配置

#### 预期结果：
- ✅ 语言偏好正确保存
- ✅ 刷新页面后语言偏好保持不变

---

### 4. 测试文件整理（完整流程）

#### 准备：
1. 准备一个包含待整理文件的文件夹
2. 准备一个媒体库路径（包含电影/电视剧目录）

#### 步骤：
1. 在"待整理路径"输入框中输入待整理文件夹路径
2. 点击"扫描文件"按钮
3. 在"媒体库路径"输入框中输入媒体库路径
4. 选择语言偏好
5. 点击"智能整理"按钮
6. 查看预览对话框
7. 确认执行

#### 预期结果：
- ✅ 文件正确识别和分类
- ✅ 文件名格式正确：
  - 电视剧：`剧名 - S01E08 - 第 08 集.mkv`
  - 电影：`电影名 (年份).mkv`
- ✅ 文件移动到正确的二级分类目录：
  - 电视剧：`媒体库/电视剧/分类/剧名/Season X/文件名`
  - 电影：`媒体库/电影/分类/电影名/文件名`
- ✅ 如果分类目录不存在，自动创建

---

### 5. 测试向后兼容性

#### 步骤：
1. 清除 localStorage 中的 `mediaLibraryPath`
2. 在"电影输出路径"和"电视剧输出路径"输入框中输入路径
3. 执行文件整理

#### 预期结果：
- ✅ 使用旧配置方式正常工作
- ✅ 文件正确移动到指定路径

---

## 测试用例

### 用例 1：新媒体库（无现有分类）
- **输入**：空的媒体库路径
- **预期**：自动创建电影/电视剧目录，根据内容创建分类目录

### 用例 2：现有媒体库（有分类）
- **输入**：包含现有分类的媒体库路径
- **预期**：检测到现有分类，文件移动到匹配的分类目录

### 用例 3：混合目录名称（中英文）
- **输入**：包含中文和英文目录名的媒体库
- **预期**：正确识别并使用现有目录

### 用例 4：语言偏好测试
- **输入**：选择"中文"偏好
- **预期**：创建中文目录名（电影、电视剧）
- **输入**：选择"English"偏好
- **预期**：创建英文目录名（Movies、TV Shows）

---

## 常见问题

### Q1: 检测按钮没有反应？
- 检查是否输入了媒体库路径
- 检查路径是否存在
- 打开浏览器控制台查看错误信息

### Q2: 检测结果显示"检测失败"？
- 检查路径是否正确
- 检查是否有读取权限
- 查看后端日志

### Q3: 文件整理后路径不正确？
- 检查媒体库路径配置
- 检查语言偏好设置
- 查看后端日志中的路径生成信息

---

## 调试技巧

### 前端调试
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页的错误信息
3. 查看 Network 标签页的 API 请求和响应

### 后端调试
1. 查看终端中的 Python 日志
2. 检查 API 响应内容
3. 添加 print 语句输出调试信息

---

## 下一步

完成测试后，继续执行：
- Task 9: 更新前端整理页面
- Task 10: 添加配置迁移提示
- Task 11-14: 测试和优化
